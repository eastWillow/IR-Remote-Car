C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 17:04:41 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE IR_REMOTE_CAR
OBJECT MODULE PLACED IN IR-Remote-Car.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE IR-Remote-Car.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*
   2          TA7267
   3          IN1 IN2 OUT1 OUT2
   4           1   1    L    L break
   5           0   1    L    H backward
   6           1   0    H    L forward
   7           0   0    Z    Z nothing
   8          */
   9          /*
  10          Wiring
  11            YELLOW
  12            BLACK
  13            RED
  14            YELLOW
  15            ORANGE
  16            BLUE
  17          */
  18          #include <STC12C5A60S2.H>
  19          #include <intrins.h>
  20          #define ALL_WIDTH 20000 //20ms
  21          #define FULL 65535
  22          #define ADRESS 0xA5
  23          #define IRHIGH 1844
  24          #define IRLOW 524
  25          sbit SERVOMOTOR1=P1^3; //PWM I/O
  26          sbit LIMITSWITCH=P3^2; // INT0
  27          sbit IR_RECEIVER=P3^3; // INT1
  28          sbit IN1=P0^1;
  29          sbit IN2=P0^2;
  30          bit repeat;
  31          unsigned int servoMotorHighTime = 1250;
  32          void setup();
  33          void Delay100ms();
  34          unsigned char irReceiver();
  35          void uartSend (char *string,char len,char EOL);
  36          void UartInit(void);
  37          void main(){
  38   1        char debug[1];
  39   1        setup();
  40   1        UartInit();
  41   1        while(1){
  42   2          uartSend("Wellcom",7,1);
  43   2          debug[0]=irReceiver();
  44   2          uartSend(debug,1,1);
  45   2        }
  46   1      }
  47          void setup(){
  48   1        EA = 1;
  49   1        ET0 = 1;
  50   1        EX0 = 1;
  51   1        PX0 = 1;
  52   1        TR0 = 0; //reset Timer0 Switch
  53   1        TR0 = 0; //reset Timer1 Switch
  54   1        TMOD = 0x11; //0010 0010
  55   1        TL0 = (FULL - ALL_WIDTH - servoMotorHighTime) %256;
C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 17:04:41 PAGE 2   

  56   1        TH0 = (FULL - ALL_WIDTH - servoMotorHighTime) / 256;
  57   1        SERVOMOTOR1 = 0;
  58   1        TR0 = 1;
  59   1      }
  60          void servoMotor () interrupt 1 {
  61   1        TR0 = 0;
  62   1        if(SERVOMOTOR1){
  63   2          TL0 = (FULL - ALL_WIDTH - servoMotorHighTime) %256;
  64   2          TH0 = (FULL - ALL_WIDTH - servoMotorHighTime) / 256;
  65   2          SERVOMOTOR1 = 0;
  66   2        }
  67   1        else{
  68   2          TL0 = (FULL - servoMotorHighTime) %256;
  69   2          TH0 = (FULL - servoMotorHighTime) / 256;
  70   2          SERVOMOTOR1 = 1;
  71   2        }
  72   1        TR0 = 1;
  73   1      }
  74          void limitSwitch () interrupt 0{
  75   1        IN1 =0;
  76   1        IN2 =1;
  77   1        Delay100ms();
  78   1        Delay100ms();
  79   1        Delay100ms();
  80   1        Delay100ms();
  81   1        Delay100ms();
  82   1      }
  83          void Delay100ms()   //@12.000MHz
  84          {
  85   1        unsigned char i, j, k;
  86   1      
  87   1        _nop_();
  88   1        _nop_();
  89   1        i = 5;
  90   1        j = 144;
  91   1        k = 71;
  92   1        do
  93   1        {
  94   2          do
  95   2          {
  96   3            while (--k);
  97   3          } while (--j);
  98   2        } while (--i);
  99   1      }
 100          unsigned char irReceiver(){
 101   1        unsigned int TimePass;
 102   1        unsigned char adress;
 103   1        unsigned char direction;
 104   1        unsigned char counter;
 105   1            if(!IR_RECEIVER){
 106   2            TH1 = 0;
 107   2            TL1 = 0;
 108   2            TR1 = 1;
 109   2            while(!IR_RECEIVER) TimePass = TL1 | (TH1 << 8);
 110   2            if(TimePass > 8400){
 111   3              TR1 = 0;
 112   3              TH1 = 0;
 113   3              TL1 = 0;
 114   3              TR1 = 1;
 115   3              while(IR_RECEIVER) TimePass = TL1 | (TH1 << 8);
 116   3              if(TimePass > 4200){
 117   4                repeat = 0;
C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 17:04:41 PAGE 3   

 118   4              }
 119   3            }
 120   2            else{
 121   3              TR1 = 0;
 122   3              TH1 = 0;
 123   3              TL1 = 0;
 124   3              repeat = 1;
 125   3            }
 126   2            if(!repeat){
 127   3              for(counter = 0;counter < 8;counter++){
 128   4                while(!IR_RECEIVER);
 129   4                TR1 = 1;
 130   4                while(IR_RECEIVER) TimePass = TL1 | (TH1 << 8);
 131   4                TR1 = 0;
 132   4                TL1 = 0;
 133   4                TH1 = 0;
 134   4                if(TimePass > IRHIGH) adress | (1 << counter);
*** WARNING C275 IN LINE 134 OF IR-Remote-Car.c: expression with possibly no effect
 135   4                else if (TimePass > IRLOW) adress | (0 << counter);
*** WARNING C275 IN LINE 135 OF IR-Remote-Car.c: expression with possibly no effect
 136   4              }
 137   3            }
 138   2            for(counter = 0;counter < 8;counter++){
 139   3                while(!IR_RECEIVER);
 140   3                TR1 = 1;
 141   3                while(IR_RECEIVER) TimePass = TL1 | (TH1 << 8);
 142   3                TR1 = 0;
 143   3                TL1 = 0;
 144   3                TH1 = 0;
 145   3                if(TimePass > IRHIGH) direction | (1 << counter);
*** WARNING C275 IN LINE 145 OF IR-Remote-Car.c: expression with possibly no effect
 146   3                else if (TimePass > IRLOW) direction | (0 << counter);
*** WARNING C275 IN LINE 146 OF IR-Remote-Car.c: expression with possibly no effect
 147   3            }
 148   2          }
 149   1          if(adress == ADRESS) return direction;
 150   1          else return 0;
 151   1      }
 152          void UartInit(void)   //9600bps@12.000MHz
 153          {
 154   1        PCON &= 0x7F;   //Baudrate no doubled
 155   1        SCON = 0x50;    //8bit and variable baudrate
 156   1        AUXR |= 0x04;   //BRT's clock is Fosc (1T)
 157   1        BRT = 0xD9;   //Set BRT's reload value
 158   1        AUXR |= 0x01;   //Use BRT as baudrate generator
 159   1        AUXR |= 0x10;   //BRT running
 160   1      }
 161          void uartSend (char *string,char len,char EOL){
 162   1        int i;
 163   1        for(i=0;i<len;i++){
 164   2          SBUF = string[i];
 165   2          while(!TI);
 166   2          TI=0;
 167   2        }
 168   1        if(EOL == 1){
 169   2          SBUF = 0x0D;
 170   2          while(!TI);
 171   2          TI=0;
 172   2          SBUF = 0x0A;
 173   2          while(!TI);
 174   2          TI=0;
 175   2        }
C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 17:04:41 PAGE 4   

 176   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    700    ----
   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
