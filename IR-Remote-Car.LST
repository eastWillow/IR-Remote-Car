C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 18:12:07 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE IR_REMOTE_CAR
OBJECT MODULE PLACED IN IR-Remote-Car.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE IR-Remote-Car.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*
   2          TA7267
   3          IN1 IN2 OUT1 OUT2
   4           1   1    L    L break
   5           0   1    L    H backward
   6           1   0    H    L forward
   7           0   0    Z    Z nothing
   8          */
   9          /*
  10          Wiring
  11            YELLOW
  12            BLACK
  13            RED
  14            YELLOW
  15            ORANGE
  16            BLUE
  17          */
  18          #include <STC12C5A60S2.H>
  19          #include <intrins.h>
  20          #define ALL_WIDTH 20000 //20ms
  21          #define FULL 65535
  22          #define ADRESS 0xA5
  23          #define IRHIGH 2 //1844
  24          #define IRLOW 1 //524
  25          sbit SERVOMOTOR1=P1^3; //PWM I/O
  26          sbit LIMITSWITCH=P3^2; // INT0
  27          sbit IR_RECEIVER=P3^3; // INT1
  28          sbit IN1=P0^1;
  29          sbit IN2=P0^2;
  30          bit repeat;
  31          unsigned int servoMotorHighTime = 1250;
  32          void setup();
  33          void Delay100ms();
  34          unsigned char irReceiver();
  35          void uartSend (char *string,char len,char EOL);
  36          void UartInit(void);
  37          void main(){
  38   1        unsigned char direction;
  39   1        setup();
  40   1        while(1){
  41   2          direction = irReceiver();
  42   2        }
  43   1      }
  44          void setup(){
  45   1        EA = 1;
  46   1        ET0 = 1;
  47   1        EX0 = 1;
  48   1        PX0 = 1;
  49   1        TR0 = 0; //reset Timer0 Switch
  50   1        TR0 = 0; //reset Timer1 Switch
  51   1        TMOD = 0x11; //0010 0010
  52   1        TL0 = (FULL - ALL_WIDTH - servoMotorHighTime) %256;
  53   1        TH0 = (FULL - ALL_WIDTH - servoMotorHighTime) / 256;
  54   1        SERVOMOTOR1 = 0;
  55   1        TR0 = 1;
C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 18:12:07 PAGE 2   

  56   1      }
  57          void servoMotor () interrupt 1 {
  58   1        TR0 = 0;
  59   1        if(SERVOMOTOR1){
  60   2          TL0 = (FULL - ALL_WIDTH - servoMotorHighTime) %256;
  61   2          TH0 = (FULL - ALL_WIDTH - servoMotorHighTime) / 256;
  62   2          SERVOMOTOR1 = 0;
  63   2        }
  64   1        else{
  65   2          TL0 = (FULL - servoMotorHighTime) %256;
  66   2          TH0 = (FULL - servoMotorHighTime) / 256;
  67   2          SERVOMOTOR1 = 1;
  68   2        }
  69   1        TR0 = 1;
  70   1      }
  71          void limitSwitch () interrupt 0{
  72   1        IN1 =0;
  73   1        IN2 =1;
  74   1        Delay100ms();
  75   1        Delay100ms();
  76   1        Delay100ms();
  77   1        Delay100ms();
  78   1        Delay100ms();
  79   1      }
  80          void Delay100ms()   //@12.000MHz
  81          {
  82   1        unsigned char i, j, k;
  83   1      
  84   1        _nop_();
  85   1        _nop_();
  86   1        i = 5;
  87   1        j = 144;
  88   1        k = 71;
  89   1        do
  90   1        {
  91   2          do
  92   2          {
  93   3            while (--k);
  94   3          } while (--j);
  95   2        } while (--i);
  96   1      }
  97          unsigned char irReceiver(){
  98   1        unsigned char adress;
  99   1        unsigned char direction;
 100   1        unsigned char counter;
 101   1        unsigned char timeCounter;
 102   1        while(!IR_RECEIVER) timeCounter++;
 103   1        if(timeCounter > 8400){
 104   2          while(IR_RECEIVER);
 105   2          while(!IR_RECEIVER);
 106   2        }
 107   1        //starting
 108   1        for(counter = 0;counter <8;counter++){
 109   2          while(IR_RECEIVER) timeCounter++;
 110   2          if(timeCounter > IRHIGH) adress | (0x01 << counter);
*** WARNING C275 IN LINE 110 OF IR-Remote-Car.c: expression with possibly no effect
 111   2          else if(timeCounter > IRLOW) adress | (0x00 << counter);
*** WARNING C275 IN LINE 111 OF IR-Remote-Car.c: expression with possibly no effect
 112   2          while(!IR_RECEIVER);
 113   2        }
 114   1        for(counter = 0;counter <8;counter++){
 115   2          while(IR_RECEIVER) timeCounter++;
C51 COMPILER V9.52.0.0   IR_REMOTE_CAR                                                     07/14/2014 18:12:07 PAGE 3   

 116   2          if(timeCounter > IRHIGH) direction | (0x01 << counter);
*** WARNING C275 IN LINE 116 OF IR-Remote-Car.c: expression with possibly no effect
 117   2          else if(timeCounter > IRLOW) direction | (0x00 << counter);
*** WARNING C275 IN LINE 117 OF IR-Remote-Car.c: expression with possibly no effect
 118   2          while(!IR_RECEIVER);
 119   2        }
 120   1        while(!IR_RECEIVER);
 121   1        if(adress == ADRESS) return direction;
 122   1      }
*** WARNING C291 IN LINE 122 OF IR-Remote-Car.c: not every exit path returns a value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    470    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  5 WARNING(S),  0 ERROR(S)
